<% content_for(:title) { "Create Sandcastle" } %>

<div class="max-w-3xl mx-auto px-4 py-8">
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-900">Create Sandcastle</h1>
    <p class="text-gray-500 mt-1">Configure and create a new sandbox environment</p>
  </div>

  <%= form_with url: sandboxes_path, method: :post, class: "space-y-6" do |form| %>
    <%# Basic Information %>
    <div class="bg-white rounded-lg border border-gray-200 p-6 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900">Basic Information</h2>

      <div>
        <%= form.label :name, "Sandbox Name", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :name,
              required: true,
              pattern: "[a-z][a-z0-9_\\-]*",
              maxlength: 63,
              placeholder: "",
              id: "sandbox_name",
              class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
        <p class="mt-1 text-xs text-gray-500">Lowercase letters, numbers, hyphens, and underscores only</p>
      </div>

      <div>
        <%= form.label :image, "Container Image", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :image,
              placeholder: "ghcr.io/thieso2/sandcastle-sandbox:latest",
              class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
        <p class="mt-1 text-xs text-gray-500">Leave empty to use the default image</p>
      </div>
    </div>

    <%# Restore from Snapshot %>
    <% if @snapshots.any? %>
      <div class="bg-white rounded-lg border border-gray-200 p-6 space-y-4">
        <h2 class="text-lg font-semibold text-gray-900">Restore from Snapshot</h2>

        <div>
          <%= form.label :snapshot, "Snapshot", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.select :snapshot,
                options_for_select([["None (fresh sandbox)", ""]] + @snapshots.map { |s| [s[:name], s[:name]] }),
                {},
                class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          <p class="mt-1 text-xs text-gray-500">Create a new sandbox from an existing snapshot</p>
        </div>
      </div>
    <% end %>

    <%# Storage Options %>
    <div class="bg-white rounded-lg border border-gray-200 p-6 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900">Storage Options</h2>

      <div class="space-y-3">
        <label class="flex items-start gap-3 cursor-pointer">
          <%= form.check_box :persistent, class: "mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" %>
          <div class="flex-1">
            <div class="text-sm font-medium text-gray-900">Enable persistent volume</div>
            <p class="text-xs text-gray-500">Create a persistent /data volume that survives sandbox recreation</p>
          </div>
        </label>

        <label class="flex items-start gap-3 cursor-pointer">
          <%= form.check_box :mount_home, class: "mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" %>
          <div class="flex-1">
            <div class="text-sm font-medium text-gray-900">Mount persistent home directory</div>
            <p class="text-xs text-gray-500">Your home directory (~/) will persist across all sandboxes</p>
          </div>
        </label>

        <div>
          <%= form.label :data_path, "Data Path", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :data_path,
                placeholder: "e.g., . (all user data) or projects/myapp",
                class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          <p class="mt-1 text-xs text-gray-500">Mount user data directory (or subpath) to /data in the sandbox</p>
        </div>
      </div>
    </div>

    <%# Network Options %>
    <% if Current.user.tailscale_enabled? %>
      <div class="bg-white rounded-lg border border-gray-200 p-6 space-y-4">
        <h2 class="text-lg font-semibold text-gray-900">Network Options</h2>

        <label class="flex items-start gap-3 cursor-pointer">
          <%= form.check_box :tailscale, checked: true, class: "mt-1 h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" %>
          <div class="flex-1">
            <div class="text-sm font-medium text-gray-900">Connect to Tailscale network</div>
            <p class="text-xs text-gray-500">Automatically connect this sandbox to your Tailscale network</p>
          </div>
        </label>
      </div>
    <% end %>

    <%# Actions %>
    <div class="flex items-center justify-between pt-4">
      <%= link_to "Cancel", root_path, class: "text-gray-600 hover:text-gray-900" %>
      <%= form.submit "Create Sandcastle", class: "px-6 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-200" %>
    </div>
  <% end %>
</div>

<script>
(function() {
  var adjectives = ["swift", "brave", "wild", "calm", "bold", "wise", "cool", "warm", "bright", "dark", "silent", "loud", "quick", "slow", "happy", "zen", "cosmic", "electric", "quantum", "digital"];
  var nouns = ["fox", "wolf", "eagle", "tiger", "bear", "shark", "hawk", "lion", "dragon", "phoenix", "cobra", "falcon", "raven", "panther", "viper", "lynx", "orca", "jaguar", "puma", "leopard"];

  function generateName() {
    var adj = adjectives[Math.floor(Math.random() * adjectives.length)];
    var noun = nouns[Math.floor(Math.random() * nouns.length)];
    return adj + "-" + noun;
  }

  var nameField = document.getElementById("sandbox_name");
  if (nameField) {
    nameField.value = generateName();
  }
})();
</script>
