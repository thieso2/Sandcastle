<div class="bg-white rounded-lg border border-gray-200 p-4 space-y-3 transition-all duration-200 hover:shadow-md
            <%= 'animate-pulse border-blue-300' if sandbox.job_in_progress? %>
            <%= 'border-red-300' if sandbox.job_failed? %>"
     id="<%= dom_id(sandbox) %>">

  <%# Line 1: Status, name, pills %>
  <div class="flex items-center justify-between gap-4">
    <div class="flex items-center gap-2 flex-wrap">
      <%# Status indicator with animation %>
      <span class="inline-block w-2.5 h-2.5 rounded-full transition-colors duration-200
        <%= if sandbox.job_in_progress?
              'bg-blue-500 animate-pulse'
            elsif sandbox.job_failed?
              'bg-red-500'
            else
              case sandbox.status
              when 'running' then 'bg-green-500'
              when 'stopped' then 'bg-yellow-500'
              when 'pending' then 'bg-blue-500'
              else 'bg-gray-400'
              end
            end %>">
      </span>

      <span class="font-mono font-medium text-gray-900"><%= sandbox.name %></span>

      <%# Job status badge %>
      <% if sandbox.job_in_progress? %>
        <span class="text-xs font-medium text-blue-700 bg-blue-100 px-2 py-0.5 rounded animate-pulse inline-flex items-center gap-1">
          <svg class="animate-spin h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <%= sandbox.job_status.humanize %>
        </span>
      <% elsif sandbox.job_failed? %>
        <span class="text-xs font-medium text-red-700 bg-red-100 px-2 py-0.5 rounded inline-flex items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
            <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z" clip-rule="evenodd" />
          </svg>
          Failed
        </span>
      <% end %>

      <%# Existing feature pills (temp, home, data, volume, Tailscale, routes) %>
      <% if sandbox.temp? %>
        <span class="text-xs font-medium text-amber-700 bg-amber-100 px-1.5 py-0.5 rounded">temp</span>
      <% end %>
      <% if sandbox.mount_home? %>
        <span class="text-xs font-medium text-blue-700 bg-blue-100 px-1.5 py-0.5 rounded inline-flex items-center gap-0.5">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3"><path fill-rule="evenodd" d="M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707l7-7Z" clip-rule="evenodd" /></svg>
          home
        </span>
      <% end %>
      <% if sandbox.data_path.present? %>
        <span class="text-xs font-medium text-blue-700 bg-blue-100 px-1.5 py-0.5 rounded">
          data<%= ":#{sandbox.data_path}" unless sandbox.data_path == "." %>
        </span>
      <% end %>
      <% if sandbox.persistent_volume? %>
        <span class="text-xs font-medium text-blue-700 bg-blue-100 px-1.5 py-0.5 rounded">volume</span>
      <% end %>
      <% if sandbox.tailscale? %>
        <span class="text-xs font-medium text-purple-700 bg-purple-100 px-1.5 py-0.5 rounded">Tailscale</span>
      <% end %>
      <% sandbox.routes.each do |route| %>
        <a href="<%= route.url %>" target="_blank" rel="noopener" class="text-xs font-medium text-green-700 bg-green-100 px-1.5 py-0.5 rounded hover:bg-green-200 transition-colors inline-flex items-center gap-0.5">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3"><path fill-rule="evenodd" d="M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z" clip-rule="evenodd" /></svg>
          <%= route.domain %>:<%= route.port %>
        </a>
      <% end %>
    </div>

    <%# Action buttons %>
    <div class="flex items-center gap-2 shrink-0">
      <% if sandbox.job_in_progress? %>
        <span class="text-xs text-gray-500 italic">Processing...</span>
      <% elsif sandbox.job_failed? %>
        <%= button_to retry_sandbox_path(sandbox), method: :post,
              class: "text-xs px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors inline-flex items-center gap-1" do %>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3.5 h-3.5">
            <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z" clip-rule="evenodd" />
          </svg>
          Retry
        <% end %>
      <% elsif sandbox.temp? %>
        <div data-controller="inline-confirm" class="inline-block">
          <%= button_to "Remove", sandbox_path(sandbox), method: :delete,
                class: "text-xs px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",
                data: {
                  action: "click->inline-confirm#confirm",
                  confirm_message: "Remove? (data lost)"
                } %>
        </div>
      <% else %>
        <% if sandbox.status == "stopped" %>
          <%= button_to "Start", start_sandbox_path(sandbox), method: :post,
                class: "text-xs px-3 py-1.5 bg-green-600 text-white rounded hover:bg-green-700 transition-colors" %>
        <% elsif sandbox.status == "running" %>
          <%= button_to terminal_sandbox_path(sandbox), method: :post,
                form: { target: "_blank" },
                class: "text-xs px-2 py-1.5 bg-gray-700 text-white rounded hover:bg-gray-800 transition-colors inline-flex items-center gap-1",
                data: { turbo: false } do %>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3.5 h-3.5">
              <path fill-rule="evenodd" d="M3.25 3A2.25 2.25 0 0 0 1 5.25v9.5A2.25 2.25 0 0 0 3.25 17h13.5A2.25 2.25 0 0 0 19 14.75v-9.5A2.25 2.25 0 0 0 16.75 3H3.25Zm.943 8.752a.75.75 0 0 1 .055-1.06L6.128 9l-1.88-1.693a.75.75 0 1 1 1.004-1.114l2.5 2.25a.75.75 0 0 1 0 1.114l-2.5 2.25a.75.75 0 0 1-1.06-.055ZM9.75 10.25a.75.75 0 0 0 0 1.5h2.5a.75.75 0 0 0 0-1.5h-2.5Z" clip-rule="evenodd" />
            </svg>
            Terminal
          <% end %>
          <%= button_to "Stop", stop_sandbox_path(sandbox), method: :post,
                class: "text-xs px-3 py-1.5 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors" %>
        <% end %>
        <div data-controller="inline-confirm" class="inline-block">
          <%= button_to "Destroy", sandbox_path(sandbox), method: :delete,
                class: "text-xs px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",
                data: {
                  action: "click->inline-confirm#confirm",
                  confirm_message: "Destroy?"
                } %>
        </div>
      <% end %>
    </div>
  </div>

  <%# Error display %>
  <% if sandbox.job_failed? %>
    <div class="text-sm text-red-600 bg-red-50 p-3 rounded border border-red-200 animate-fadeIn">
      <div class="flex items-start gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 shrink-0 mt-0.5">
          <path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-8-5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 5Zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />
        </svg>
        <div>
          <strong class="font-medium">Operation Failed</strong>
          <p class="mt-1 text-xs"><%= sandbox.job_error %></p>
        </div>
      </div>
    </div>
  <% end %>

  <%# Container info and stats %>
  <div class="flex items-start justify-between gap-4 pt-1">
    <div class="text-xs text-gray-400">
      <% if sandbox.container_id.present? %>
        <span class="font-mono"><%= sandbox.container_id.first(12) %></span> 路
      <% end %>
      <span class="font-mono"><%= sandbox.image.sub("ghcr.io/thieso2/", "") %></span>
      路 Created <%= time_ago_in_words(sandbox.created_at) %> ago
      <% if sandbox.status == "running" %>
        路 Running for <%= time_ago_in_words(sandbox.updated_at) %>
      <% elsif sandbox.status == "stopped" %>
        路 Stopped <%= time_ago_in_words(sandbox.updated_at) %> ago
      <% end %>
    </div>

    <div class="w-80 shrink-0 text-right">
      <% if sandbox.status == "running" %>
        <%= turbo_frame_tag "sandbox_stats_#{sandbox.id}", src: stats_sandbox_path(sandbox), loading: :lazy do %>
          <span class="text-xs text-gray-400">loading stats...</span>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
