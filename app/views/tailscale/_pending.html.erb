<%# ── Waiting for login ── %>
<div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
  <div class="flex items-center gap-2 mb-4">
    <span class="inline-block w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></span>
    <h2 class="text-lg font-semibold text-gray-900">Waiting for Login</h2>
  </div>

  <p class="text-sm text-gray-600 mb-4">
    A Tailscale sidecar has been started. Log in with your Tailscale account to connect it to your tailnet.
  </p>

  <% if login_url.present? %>
    <a href="<%= login_url %>" target="_blank" rel="noopener"
       class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm mb-4">
      Open Tailscale Login
    </a>
  <% end %>

  <div id="login-status" class="text-sm text-gray-500 mb-4">Waiting for login...</div>

  <div class="flex gap-3">
    <%= button_to "Cancel", disable_tailscale_path, method: :delete,
          class: "px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm" %>
  </div>
</div>

<script>
  (function() {
    var poll = setInterval(function() {
      fetch("<%= login_status_tailscale_path %>", { headers: { "Accept": "application/json" } })
        .then(function(r) { return r.json(); })
        .then(function(data) {
          if (data.status === "authenticated") {
            clearInterval(poll);
            window.location.reload();
          } else if (data.status === "error") {
            document.getElementById("login-status").textContent = "Error: " + data.error;
            clearInterval(poll);
          } else {
            document.getElementById("login-status").textContent = "Waiting for login...";
          }
        })
        .catch(function() {
          document.getElementById("login-status").textContent = "Connection error, retrying...";
        });
    }, 3000);
  })();
</script>
