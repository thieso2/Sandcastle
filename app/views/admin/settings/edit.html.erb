<div class="max-w-4xl mx-auto px-4 py-8">
  <% if alert = flash[:alert] %>
    <p class="py-2 px-3 bg-red-50 mb-5 text-red-500 font-medium rounded-lg inline-block" id="alert"><%= alert %></p>
  <% end %>

  <% if notice = flash[:notice] %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-lg inline-block" id="notice"><%= notice %></p>
  <% end %>

  <h1 class="text-3xl font-bold text-gray-900 mb-8">Settings</h1>

  <%= form_with model: @setting, url: admin_settings_path, method: :patch, class: "space-y-8" do |form| %>

    <%# === GitHub OAuth === %>
    <div class="rounded-lg border border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-1">GitHub OAuth</h2>
      <p class="text-sm text-gray-500 mb-4">Allow users to sign in with their GitHub account.</p>

      <div class="grid gap-4 sm:grid-cols-2">
        <div>
          <%= form.label :github_client_id, "Client ID", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :github_client_id,
                value: @setting.github_client_id,
                placeholder: ENV["GITHUB_CLIENT_ID"].present? ? "Set via ENV" : "Enter client ID",
                class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
        <div>
          <%= form.label :github_client_secret, "Client Secret", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.password_field :github_client_secret,
                placeholder: @setting.github_client_secret.present? ? "Secret is set (leave blank to keep)" : "Enter client secret",
                class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
      </div>

      <% if Setting.github_configured? %>
        <p class="mt-3 text-sm text-green-600">GitHub OAuth is active.</p>
      <% elsif ENV["GITHUB_CLIENT_ID"].present? %>
        <p class="mt-3 text-sm text-gray-500">Currently using ENV variables.</p>
      <% end %>
    </div>

    <%# === Google OAuth === %>
    <div class="rounded-lg border border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-1">Google OAuth</h2>
      <p class="text-sm text-gray-500 mb-4">Allow users to sign in with their Google account.</p>

      <div class="grid gap-4 sm:grid-cols-2">
        <div>
          <%= form.label :google_client_id, "Client ID", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :google_client_id,
                value: @setting.google_client_id,
                placeholder: ENV["GOOGLE_CLIENT_ID"].present? ? "Set via ENV" : "Enter client ID",
                class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
        <div>
          <%= form.label :google_client_secret, "Client Secret", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.password_field :google_client_secret,
                placeholder: @setting.google_client_secret.present? ? "Secret is set (leave blank to keep)" : "Enter client secret",
                class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
      </div>

      <% if Setting.google_configured? %>
        <p class="mt-3 text-sm text-green-600">Google OAuth is active.</p>
      <% elsif ENV["GOOGLE_CLIENT_ID"].present? %>
        <p class="mt-3 text-sm text-gray-500">Currently using ENV variables.</p>
      <% end %>
    </div>

    <%# === SMTP === %>
    <div class="rounded-lg border border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-1">SMTP / Email</h2>
      <p class="text-sm text-gray-500 mb-4">Configure outgoing email for password resets and user invites.</p>

      <div class="grid gap-4 sm:grid-cols-2">
        <div>
          <%= form.label :smtp_address, "SMTP Server", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :smtp_address,
                placeholder: "smtp.example.com",
                class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
        <div>
          <%= form.label :smtp_port, "Port", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.number_field :smtp_port,
                class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
        <div>
          <%= form.label :smtp_username, "Username", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :smtp_username,
                placeholder: "user@example.com",
                class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
        <div>
          <%= form.label :smtp_password, "Password", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.password_field :smtp_password,
                placeholder: @setting.smtp_password.present? ? "Password is set (leave blank to keep)" : "Enter password",
                class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
        <div>
          <%= form.label :smtp_authentication, "Authentication", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.select :smtp_authentication, [["Plain", "plain"], ["Login", "login"], ["CRAM-MD5", "cram_md5"]],
                {}, class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
        <div>
          <%= form.label :smtp_from_address, "From Address", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.email_field :smtp_from_address,
                placeholder: "noreply@example.com",
                class: "block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-blue-600" %>
        </div>
      </div>

      <div class="mt-4">
        <%= form.label :smtp_starttls, class: "inline-flex items-center gap-2 text-sm text-gray-700 cursor-pointer" do %>
          <%= form.check_box :smtp_starttls, class: "rounded border-gray-300" %>
          Enable STARTTLS
        <% end %>
      </div>

      <% if Setting.smtp_configured? %>
        <p class="mt-3 text-sm text-green-600">SMTP is configured.</p>
      <% end %>
    </div>

    <div class="flex items-center gap-3">
      <%= form.submit "Save Settings", class: "rounded-md px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium cursor-pointer" %>

      <button type="submit" name="test_email" value="1"
              class="rounded-md px-3.5 py-2.5 border border-gray-300 hover:bg-gray-50 text-sm font-medium cursor-pointer">
        Save & Send Test Email
      </button>
    </div>
  <% end %>
</div>
