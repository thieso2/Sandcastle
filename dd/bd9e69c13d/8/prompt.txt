## Summary
Add Google Chrome and the Claude Code Chrome extension to sandbox containers, with browser-based VNC access for users to interact with Chrome GUI.

## Motivation
- Enable users to run browser automation and testing in sandboxes
- Provide Claude Code Chrome extension for enhanced development workflows
- Allow visual interaction with Chrome through web-based VNC

## Proposed Implementation

### 1. Sandbox Image Updates
- Install Chrome (stable) in `images/sandbox/Dockerfile`
- Install Xvfb (virtual display)
- Install x11vnc or similar VNC server
- Consider Chrome headless mode as alternative for some use cases

### 2. VNC Access Options
**Recommended: noVNC** (similar to WeTTY architecture)
- Sidecar container: `sc-vnc-{user}-{sandbox}`
- Connect to sandbox's VNC server
- Traefik routing: `/vnc/{sandbox_id}` or subdomain
- ForwardAuth middleware for authentication
- Resolution: configurable (default 1920x1080)

**Alternative: Apache Guacamole** (more features, heavier)

### 3. Chrome Extension Installation
- Pre-install Claude Code extension in sandbox image
- Mount extension data to persistent user home: `/data/users/{name}/.config/google-chrome`
- Document extension setup in guide

### 4. Service Layer
New `VncManager` service class:
- `#open(sandbox)` - Start VNC sidecar, generate Traefik config
- `#close(sandbox)` - Stop VNC sidecar, cleanup config
- Similar to `TerminalManager` pattern

### 5. UI Integration
- "Open Browser" button next to "Open Terminal" on sandbox show page
- Display resolution selector
- VNC connection status indicator

## Technical Considerations
- **Display:** Xvfb :99 (virtual X server)
- **VNC Port:** Expose internally, not on host (noVNC container connects)
- **Authentication:** Same ForwardAuth pattern as WeTTY
- **Performance:** Consider websockify compression settings
- **Network:** Use `sandcastle-web` network for noVNC sidecars
- **Cleanup:** Background job to kill stale VNC sessions

## Security Notes
- VNC traffic stays within Docker network (not exposed to host)
- Authentication required via Traefik forwardAuth
- Consider view-only mode option
- Rate limit VNC connection attempts

## Files to Modify
- `images/sandbox/Dockerfile` - Add Chrome, Xvfb, VNC server
- `images/sandbox/entrypoint.sh` - Start Xvfb and VNC server
- `app/services/vnc_manager.rb` - New service
- `app/controllers/vnc_controller.rb` - New controller for auth
- `app/views/sandboxes/show.html.erb` - Add "Open Browser" button
- `app/models/sandbox.rb` - Track VNC state if needed
- `config/routes.rb` - Add VNC auth route
- `app/views/pages/guide.html.erb` - Document browser access

## Open Questions
1. Should VNC be always-on or on-demand like WeTTY?
2. Display resolution: fixed or user-configurable?
3. Support multiple concurrent VNC sessions per sandbox?
4. Include other browsers (Firefox) or Chrome only?
5. Headless mode option for automation without VNC overhead?

## Related
- Similar architecture to Web Terminal (WeTTY) implementation
- Could share authentication patterns with `TerminalManager`

---

use ask tool

---

commit this

---

push

---

in installer fix the PATH that added to .bashrc and also add a banner on longin showing th sandcastle version

---

validate that setting teh PATH works!

---

commit

---

DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

---

[Request interrupted by user]

---

when building the sandbox image

---

Step 4/22 : RUN apt-get update && apt-get install -y     xvfb x11vnc xfonts-base xfonts-100dpi xfonts-75dpi     fonts-liberation libappindicator3-1 libasound2 libatk-bridge2.0-0     libatk1.0-0 libcups2 libdbus-1-3 libgdk-pixbuf2.0-0 libnspr4 libnss3     libx11-xcb1 libxcomposite1 libxdamage1 libxrandr2 xdg-utils     && wget -q https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb     && apt-get install -y ./google-chrome-stable_current_amd64.deb     && rm google-chrome-stable_current_amd64.deb     && rm -rf /var/lib/apt/lists/*
 ---> Running in 1c9aa9c76401
Get:1 http://archive.ubuntu.com/ubuntu questing InRelease [275 kB]
Get:2 http://archive.ubuntu.com/ubuntu questing-updates InRelease [136 kB]
Get:3 http://security.ubuntu.com/ubuntu questing-security InRelease [136 kB]
Get:4 http://archive.ubuntu.com/ubuntu questing-backports InRelease [133 kB]
Get:5 http://archive.ubuntu.com/ubuntu questing/restricted amd64 Packages [95.0 kB]
Get:6 http://archive.ubuntu.com/ubuntu questing/main amd64 Packages [1860 kB]
Get:7 http://archive.ubuntu.com/ubuntu questing/multiverse amd64 Packages [337 kB]
Get:8 http://archive.ubuntu.com/ubuntu questing/universe amd64 Packages [19.9 MB]
Get:9 http://archive.ubuntu.com/ubuntu questing-updates/restricted amd64 Packages [196 kB]
Get:10 http://archive.ubuntu.com/ubuntu questing-updates/main amd64 Packages [374 kB]
Get:11 http://archive.ubuntu.com/ubuntu questing-updates/multiverse amd64 Packages [3223 B]
Get:12 http://archive.ubuntu.com/ubuntu questing-updates/universe amd64 Packages [223 kB]
Get:13 http://archive.ubuntu.com/ubuntu questing-backports/universe amd64 Packages [666 B]
Get:14 http://security.ubuntu.com/ubuntu questing-security/universe amd64 Packages [138 kB]
Get:15 http://security.ubuntu.com/ubuntu questing-security/multiverse amd64 Packages [2714 B]
Get:16 http://security.ubuntu.com/ubuntu questing-security/restricted amd64 Packages [186 kB]
Get:17 http://security.ubuntu.com/ubuntu questing-security/main amd64 Packages [224 kB]
Fetched 24.2 MB in 1s (23.1 MB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Package libasound2 is a virtual package provided by:
  liboss4-salsa-asound2 4.2-build2020-6
  libasound2t64 1.2.14-1ubuntu1 (= 1.2.14-1ubuntu1)

Package libgdk-pixbuf2.0-0 is not available, but is referred to by another package.
This may mean that the package is missing, has been obsoleted, or
is only available from another source
However the following packages replace it:
  libgdk-pixbuf-xlib-2.0-0

E: Package 'libasound2' has no installation candidate
E: Package 'libgdk-pixbuf2.0-0' has no installation candidate
The command '/bin/sh -c apt-get update && apt-get install -y     xvfb x11vnc xfonts-base xfonts-100dpi xfonts-75dpi     fonts-liberation libappindicator3-1 libasound2 libatk-bridge2.0-0     libatk1.0-0 libcups2 libdbus-1-3 libgdk-pixbuf2.0-0 libnspr4 libnss3     libx11-xcb1 libxcomposite1 libxdamage1 libxrandr2 xdg-utils     && wget -q https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb     && apt-get install -y ./google-chrome-stable_current_amd64.deb     && rm google-chrome-stable_current_amd64.deb     && rm -rf /var/lib/apt/lists/*' returned a non-zero code: 100